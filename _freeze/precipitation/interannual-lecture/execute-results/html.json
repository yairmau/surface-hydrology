{
  "hash": "bb61743f9184ba72c506d9b04aed1d97",
  "result": {
    "markdown": "---\ntitle: Interannual variability of precipitation\nexecute:\n  freeze: auto\n---\n\n![](/archive/figures/monthly_tel_aviv_1940-1999.png)\n\n## hydrological year\n\nA time period of 12 months for which precipitation totals are measured. The hydrological year is designated by the calendar year in which it **ends**.  \nLet's define the hydrological year for Tel Aviv from 1 October to 30 September.\n\nהאם אקלים הגשם שלנו משתנה\n> youtube: https://youtu.be/v0uNpj03Rk4\n\n![](/archive/figures/annual_tel_aviv_with_mean.png)\n\n![](/archive/figures/histogram_tel_aviv_with_mean_and_std.png)\n\n## coefficient of variation\n\n$\\langle{P}\\rangle=$ average precipitation  \n$\\sigma=$ standard deviation\n\n$$CV = \\frac{\\sigma}{\\langle{P}\\rangle}$$\n\nAssuming that the inter-annual distribution is a gaussian: 67% of the time, rainfall will vary +/- 30% from its long term average in Tel Aviv.\n\nPrecipitation averages are [usually calculated for time intervals of 30 years](https://www.ncdc.noaa.gov/news/defining-climate-normals-new-ways).\n\n![](/archive/figures/mean_tel_aviv_2_windows.png)\n\n![](/archive/figures/mean_tel_aviv_4_windows.png)\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-fold=\"true\" code-summary=\"Show/hide the code\"}\nimport altair as alt\nimport pandas as pd\n\ndf = pd.read_csv(\"TEL_AVIV_READING_monthly.csv\", sep=\",\")\n# make 'DATE' the dataframe index\ndf['DATE'] = pd.to_datetime(df['DATE'])\ndf = df.set_index('DATE')\n\ndf_year_all = df['PRCP'].resample('A-SEP').sum().to_frame()  # annual frequency, anchored end of September\ndf_year_all.columns = ['rain (mm)'] # rename 'PRCP' column to 'rain (mm)'\ndf_year = df_year_all.iloc[:-1]  # exclude last row\n\n# Altair only recognizes column data; it ignores index values.\n# You can plot the index data by first resetting the index\n# I know that I've just made 'DATE' the index, but I want to have this here nonetheless so I can refer to this in the future\nsource = df_year.reset_index()\nbrush = alt.selection(type='interval', encodings=['x'])\n\n# T: temporal, a time or date value\n# Q: quantitative, a continuous real-valued quantity\n# https://altair-viz.github.io/user_guide/encoding.html#encoding-data-types\nbars = alt.Chart().mark_bar().encode(\n    x=alt.X('DATE:T', axis=alt.Axis(title='date')),\n    y=alt.Y('rain (mm):Q',  axis=alt.Axis(title='annual precipitation (mm) and average')),\n    opacity=alt.condition(brush, alt.OpacityValue(1), alt.OpacityValue(0.2)),\n).add_selection(\n    brush\n).properties(\n    title='Select year range and drag for rolling average of annual precipitation in Tel Aviv'\n).properties(\n    width=600,\n    height=400\n)\n\nline = alt.Chart().mark_rule(color='orange').encode(\n    y='mean(rain (mm)):Q',\n    size=alt.SizeValue(3)\n).transform_filter(\n    brush\n)\n\nalt.layer(bars, line, data=source)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n\n<div id=\"altair-viz-859cc08ff3da4569b0bb70077d193ba1\"></div>\n<script type=\"text/javascript\">\n  var VEGA_DEBUG = (typeof VEGA_DEBUG == \"undefined\") ? {} : VEGA_DEBUG;\n  (function(spec, embedOpt){\n    let outputDiv = document.currentScript.previousElementSibling;\n    if (outputDiv.id !== \"altair-viz-859cc08ff3da4569b0bb70077d193ba1\") {\n      outputDiv = document.getElementById(\"altair-viz-859cc08ff3da4569b0bb70077d193ba1\");\n    }\n    const paths = {\n      \"vega\": \"https://cdn.jsdelivr.net/npm//vega@5?noext\",\n      \"vega-lib\": \"https://cdn.jsdelivr.net/npm//vega-lib?noext\",\n      \"vega-lite\": \"https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext\",\n      \"vega-embed\": \"https://cdn.jsdelivr.net/npm//vega-embed@6?noext\",\n    };\n\n    function maybeLoadScript(lib, version) {\n      var key = `${lib.replace(\"-\", \"\")}_version`;\n      return (VEGA_DEBUG[key] == version) ?\n        Promise.resolve(paths[lib]) :\n        new Promise(function(resolve, reject) {\n          var s = document.createElement('script');\n          document.getElementsByTagName(\"head\")[0].appendChild(s);\n          s.async = true;\n          s.onload = () => {\n            VEGA_DEBUG[key] = version;\n            return resolve(paths[lib]);\n          };\n          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);\n          s.src = paths[lib];\n        });\n    }\n\n    function showError(err) {\n      outputDiv.innerHTML = `<div class=\"error\" style=\"color:red;\">${err}</div>`;\n      throw err;\n    }\n\n    function displayChart(vegaEmbed) {\n      vegaEmbed(outputDiv, spec, embedOpt)\n        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));\n    }\n\n    if(typeof define === \"function\" && define.amd) {\n      requirejs.config({paths});\n      require([\"vega-embed\"], displayChart, err => showError(`Error loading script: ${err.message}`));\n    } else {\n      maybeLoadScript(\"vega\", \"5\")\n        .then(() => maybeLoadScript(\"vega-lite\", \"4.17.0\"))\n        .then(() => maybeLoadScript(\"vega-embed\", \"6\"))\n        .catch(showError)\n        .then(() => displayChart(vegaEmbed));\n    }\n  })({\"config\": {\"view\": {\"continuousWidth\": 400, \"continuousHeight\": 300}}, \"layer\": [{\"mark\": \"bar\", \"encoding\": {\"opacity\": {\"condition\": {\"value\": 1, \"selection\": \"selector002\"}, \"value\": 0.2}, \"x\": {\"axis\": {\"title\": \"date\"}, \"field\": \"DATE\", \"type\": \"temporal\"}, \"y\": {\"axis\": {\"title\": \"annual precipitation (mm) and average\"}, \"field\": \"rain (mm)\", \"type\": \"quantitative\"}}, \"height\": 400, \"selection\": {\"selector002\": {\"type\": \"interval\", \"encodings\": [\"x\"]}}, \"title\": \"Select year range and drag for rolling average of annual precipitation in Tel Aviv\", \"width\": 600}, {\"mark\": {\"type\": \"rule\", \"color\": \"orange\"}, \"encoding\": {\"size\": {\"value\": 3}, \"y\": {\"aggregate\": \"mean\", \"field\": \"rain (mm)\", \"type\": \"quantitative\"}}, \"transform\": [{\"filter\": {\"selection\": \"selector002\"}}]}], \"data\": {\"name\": \"data-7f3deb684318fc589167f1bf7340498e\"}, \"$schema\": \"https://vega.github.io/schema/vega-lite/v4.17.0.json\", \"datasets\": {\"data-7f3deb684318fc589167f1bf7340498e\": [{\"DATE\": \"1940-09-30T00:00:00\", \"rain (mm)\": 474.9}, {\"DATE\": \"1941-09-30T00:00:00\", \"rain (mm)\": 447.8}, {\"DATE\": \"1942-09-30T00:00:00\", \"rain (mm)\": 372.9}, {\"DATE\": \"1943-09-30T00:00:00\", \"rain (mm)\": 618.2}, {\"DATE\": \"1944-09-30T00:00:00\", \"rain (mm)\": 440.5}, {\"DATE\": \"1945-09-30T00:00:00\", \"rain (mm)\": 810.6}, {\"DATE\": \"1946-09-30T00:00:00\", \"rain (mm)\": 577.3}, {\"DATE\": \"1947-09-30T00:00:00\", \"rain (mm)\": 327.79999999999995}, {\"DATE\": \"1948-09-30T00:00:00\", \"rain (mm)\": 484.5}, {\"DATE\": \"1949-09-30T00:00:00\", \"rain (mm)\": 566.1}, {\"DATE\": \"1950-09-30T00:00:00\", \"rain (mm)\": 844.1}, {\"DATE\": \"1951-09-30T00:00:00\", \"rain (mm)\": 343.8}, {\"DATE\": \"1952-09-30T00:00:00\", \"rain (mm)\": 668.9}, {\"DATE\": \"1953-09-30T00:00:00\", \"rain (mm)\": 564.5}, {\"DATE\": \"1954-09-30T00:00:00\", \"rain (mm)\": 636.8}, {\"DATE\": \"1955-09-30T00:00:00\", \"rain (mm)\": 524.4000000000001}, {\"DATE\": \"1956-09-30T00:00:00\", \"rain (mm)\": 814.8}, {\"DATE\": \"1957-09-30T00:00:00\", \"rain (mm)\": 568.4}, {\"DATE\": \"1958-09-30T00:00:00\", \"rain (mm)\": 459.8}, {\"DATE\": \"1959-09-30T00:00:00\", \"rain (mm)\": 378.40000000000003}, {\"DATE\": \"1960-09-30T00:00:00\", \"rain (mm)\": 301.7}, {\"DATE\": \"1961-09-30T00:00:00\", \"rain (mm)\": 578.9}, {\"DATE\": \"1962-09-30T00:00:00\", \"rain (mm)\": 658.6999999999999}, {\"DATE\": \"1963-09-30T00:00:00\", \"rain (mm)\": 392.1}, {\"DATE\": \"1964-09-30T00:00:00\", \"rain (mm)\": 622.7}, {\"DATE\": \"1965-09-30T00:00:00\", \"rain (mm)\": 755.5}, {\"DATE\": \"1966-09-30T00:00:00\", \"rain (mm)\": 331.0}, {\"DATE\": \"1967-09-30T00:00:00\", \"rain (mm)\": 663.6}, {\"DATE\": \"1968-09-30T00:00:00\", \"rain (mm)\": 412.4}, {\"DATE\": \"1969-09-30T00:00:00\", \"rain (mm)\": 669.4}, {\"DATE\": \"1970-09-30T00:00:00\", \"rain (mm)\": 415.1}, {\"DATE\": \"1971-09-30T00:00:00\", \"rain (mm)\": 382.0}, {\"DATE\": \"1972-09-30T00:00:00\", \"rain (mm)\": 620.4}, {\"DATE\": \"1973-09-30T00:00:00\", \"rain (mm)\": 440.5}, {\"DATE\": \"1974-09-30T00:00:00\", \"rain (mm)\": 697.5}, {\"DATE\": \"1975-09-30T00:00:00\", \"rain (mm)\": 581.7}, {\"DATE\": \"1976-09-30T00:00:00\", \"rain (mm)\": 389.8}, {\"DATE\": \"1977-09-30T00:00:00\", \"rain (mm)\": 606.8}, {\"DATE\": \"1978-09-30T00:00:00\", \"rain (mm)\": 484.3}, {\"DATE\": \"1979-09-30T00:00:00\", \"rain (mm)\": 324.7}, {\"DATE\": \"1980-09-30T00:00:00\", \"rain (mm)\": 617.6}, {\"DATE\": \"1981-09-30T00:00:00\", \"rain (mm)\": 490.40000000000003}, {\"DATE\": \"1982-09-30T00:00:00\", \"rain (mm)\": 446.0}, {\"DATE\": \"1983-09-30T00:00:00\", \"rain (mm)\": 602.4}, {\"DATE\": \"1984-09-30T00:00:00\", \"rain (mm)\": 270.3}, {\"DATE\": \"1985-09-30T00:00:00\", \"rain (mm)\": 343.2}, {\"DATE\": \"1986-09-30T00:00:00\", \"rain (mm)\": 360.2}, {\"DATE\": \"1987-09-30T00:00:00\", \"rain (mm)\": 573.6}, {\"DATE\": \"1988-09-30T00:00:00\", \"rain (mm)\": 659.6}, {\"DATE\": \"1989-09-30T00:00:00\", \"rain (mm)\": 488.9}, {\"DATE\": \"1990-09-30T00:00:00\", \"rain (mm)\": 648.5}, {\"DATE\": \"1991-09-30T00:00:00\", \"rain (mm)\": 468.90000000000003}, {\"DATE\": \"1992-09-30T00:00:00\", \"rain (mm)\": 1064.3999999999999}, {\"DATE\": \"1993-09-30T00:00:00\", \"rain (mm)\": 577.9}, {\"DATE\": \"1994-09-30T00:00:00\", \"rain (mm)\": 350.9}, {\"DATE\": \"1995-09-30T00:00:00\", \"rain (mm)\": 804.6999999999999}, {\"DATE\": \"1996-09-30T00:00:00\", \"rain (mm)\": 488.20000000000005}, {\"DATE\": \"1997-09-30T00:00:00\", \"rain (mm)\": 619.1}, {\"DATE\": \"1998-09-30T00:00:00\", \"rain (mm)\": 489.6}, {\"DATE\": \"1999-09-30T00:00:00\", \"rain (mm)\": 226.5}]}}, {\"mode\": \"vega-lite\"});\n</script>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "interannual-lecture_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}