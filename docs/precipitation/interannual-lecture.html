<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Surface Hydrology - 5&nbsp; Interannual variability of precipitation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../precipitation/interannual-exercises.html" rel="next">
<link href="../precipitation/intra-annual-exercises.html" rel="prev">
<link href="../archive/cloud-rain.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../precipitation/precipitation.html">Precipitation</a></li><li class="breadcrumb-item"><a href="../precipitation/interannual-lecture.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interannual variability of precipitation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../archive/cloud-rain.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Surface Hydrology</a> 
        <div class="sidebar-tools-main">
    <a href="https://yairmau.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house"></i></a>
    <a href="https://github.com/yairmau/surface-hydrology/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/introduction-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Water Cycle: Fluxes and Storage</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/introduction-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../precipitation/precipitation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precipitation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/intra-annual-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intra-annual variability of precipitation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/intra-annual-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/interannual-lecture.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interannual variability of precipitation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/interannual-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/return-period-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Return Period</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/return-period-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Evapotranspiration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evapotranspiration/evapotranspiration-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Evapotranspiration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evapotranspiration/evapotranspiration-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../infiltration/infiltration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infiltration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infiltration/infiltration-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Infiltration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infiltration/infiltration-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Streamflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/streamflow-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Streamflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/streamflow-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/unit-hydrograph-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Unit Hydrograph</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">summing up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summing-up/budyko-framework-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Budyko framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summing-up/spatial-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial distribution - lecture</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../assignments/assignments-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment0-first-graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Assignment - first graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment1-return-period.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Assignment - return period</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../appendix/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/date_formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Gain full control of date formatting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/plotting-guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Plotting guidelines</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#coefficient-of-variation" id="toc-coefficient-of-variation" class="nav-link active" data-scroll-target="#coefficient-of-variation"><span class="header-section-number">5.1</span> coefficient of variation</a></li>
  <li><a href="#climate-normals" id="toc-climate-normals" class="nav-link" data-scroll-target="#climate-normals"><span class="header-section-number">5.2</span> climate normals</a></li>
  <li><a href="#running-averages" id="toc-running-averages" class="nav-link" data-scroll-target="#running-averages"><span class="header-section-number">5.3</span> running averages</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../precipitation/precipitation.html">Precipitation</a></li><li class="breadcrumb-item"><a href="../precipitation/interannual-lecture.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interannual variability of precipitation</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interannual variability of precipitation</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/yairmau/surface-hydrology/blob/main/precipitation/interannual-lecture.ipynb">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>import stuff</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> register_matplotlib_converters</span>
<span id="cb1-6"><a href="#cb1-6"></a>register_matplotlib_converters()  <span class="co"># datetime converter for a matplotlib</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="im">from</span> calendar <span class="im">import</span> month_abbr</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9"></a>sns.set_theme(style<span class="op">=</span><span class="st">"ticks"</span>, font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>ModuleNotFoundError: No module named 'seaborn'</code></pre>
</div>
</div>
<div id="cell-2" class="cell">
<details class="code-fold">
<summary>load data</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"TEL_AVIV_READING_monthly.csv"</span>,</span>
<span id="cb3-2"><a href="#cb3-2"></a>                 sep<span class="op">=</span><span class="st">","</span>,</span>
<span id="cb3-3"><a href="#cb3-3"></a>                 parse_dates<span class="op">=</span>[<span class="st">'DATE'</span>],</span>
<span id="cb3-4"><a href="#cb3-4"></a>                 index_col<span class="op">=</span><span class="st">'DATE'</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-3" class="cell">
<details class="code-fold">
<summary>define useful functions</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">def</span> concise(ax):</span>
<span id="cb4-2"><a href="#cb4-2"></a>    locator <span class="op">=</span> mdates.AutoDateLocator(minticks<span class="op">=</span><span class="dv">3</span>, maxticks<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>    formatter <span class="op">=</span> mdates.ConciseDateFormatter(locator)</span>
<span id="cb4-4"><a href="#cb4-4"></a>    ax.xaxis.set_major_locator(locator)</span>
<span id="cb4-5"><a href="#cb4-5"></a>    ax.xaxis.set_major_formatter(formatter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-4" class="cell">
<details class="code-fold">
<summary>plot</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co"># plot precipitation</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>ax1.fill_between(df.index, df[<span class="st">'PRCP'</span>], <span class="dv">0</span>, color<span class="op">=</span><span class="st">'tab:blue'</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a>df_1990_1992 <span class="op">=</span> df.loc[<span class="st">'1990-07-01'</span>:<span class="st">'1992-07-01'</span>]</span>
<span id="cb5-6"><a href="#cb5-6"></a>ax2.bar(df_1990_1992.index, df_1990_1992[<span class="st">'PRCP'</span>], width<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># adjust labels, ticks, title, etc</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>ax1.set_title(<span class="st">"Monthly precipitation in Tel Aviv"</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co"># ax2.tick_params(axis='x', rotation=45)</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>ax2.set_xlabel(<span class="st">"date"</span>)</span>
<span id="cb5-12"><a href="#cb5-12"></a>concise(ax1)</span>
<span id="cb5-13"><a href="#cb5-13"></a>concise(ax2)</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co"># common y label between the two panels:</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>fig.supylabel(<span class="st">'monthly precipitation (mm)'</span>)</span>
<span id="cb5-17"><a href="#cb5-17"></a></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="co"># write yearly rainfall</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>rain_1990_1991 <span class="op">=</span> df.loc[<span class="st">'1990-07-01'</span>:<span class="st">'1991-07-01'</span>,<span class="st">'PRCP'</span>].<span class="bu">sum</span>()</span>
<span id="cb5-20"><a href="#cb5-20"></a>rain_1991_1992 <span class="op">=</span> df.loc[<span class="st">'1991-07-01'</span>:<span class="st">'1992-07-01'</span>,<span class="st">'PRCP'</span>].<span class="bu">sum</span>()</span>
<span id="cb5-21"><a href="#cb5-21"></a>ax2.text(<span class="st">'1991-01-01'</span>, <span class="dv">300</span>, <span class="st">"</span><span class="sc">{:.0f}</span><span class="st"> mm"</span>.<span class="bu">format</span>(rain_1990_1991))</span>
<span id="cb5-22"><a href="#cb5-22"></a>ax2.text(<span class="st">'1992-01-01'</span>, <span class="dv">300</span>, <span class="st">"</span><span class="sc">{:.0f}</span><span class="st"> mm"</span>.<span class="bu">format</span>(rain_1991_1992))</span>
<span id="cb5-23"><a href="#cb5-23"></a><span class="cf">pass</span></span>
<span id="cb5-24"><a href="#cb5-24"></a><span class="co"># save figure</span></span>
<span id="cb5-25"><a href="#cb5-25"></a><span class="co"># plt.savefig("monthly_tel_aviv_1940-1999.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Let’s aggregate (resample) precipitation according to the hydrological year.</p>
<div id="cell-6" class="cell">
<details class="code-fold">
<summary>resample by hydrological year</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># read more about resampling options</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># https://pandas.pydata.org/pandas-docs/version/0.12.0/timeseries.html#offset-aliases</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co"># also, annual resampling can be anchored to the end of specific months:</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># https://pandas.pydata.org/pandas-docs/version/0.12.0/timeseries.html#anchored-offsets</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>df_year <span class="op">=</span> df[<span class="st">'PRCP'</span>].resample(<span class="st">'YE-SEP'</span>).<span class="bu">sum</span>().to_frame()  <span class="co"># yearly frequency, anchored end of September</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>df_year.columns <span class="op">=</span> [<span class="st">'rain (mm)'</span>] <span class="co"># rename 'PRCP' column to 'rain (mm)'</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co"># the last year is the sum of only on month (November), let's take it out</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>df_year <span class="op">=</span> df_year.iloc[:<span class="op">-</span><span class="dv">1</span>]  <span class="co"># exclude last row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-7" class="cell">
<details class="code-fold">
<summary>plot mean</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co"># plot YEARLY precipitation</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>ax.bar(df_year.index, df_year[<span class="st">'rain (mm)'</span>],</span>
<span id="cb7-5"><a href="#cb7-5"></a>       width<span class="op">=</span><span class="dv">365</span>, align<span class="op">=</span><span class="st">'edge'</span>, color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co"># plot mean</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>rain_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb7-9"><a href="#cb7-9"></a>ax.plot(df_year<span class="op">*</span><span class="dv">0</span> <span class="op">+</span> rain_mean, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"tab:orange"</span>)</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co"># adjust labels, ticks, title, etc</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Annual precipitation in Tel Aviv, 1940–1999"</span>,</span>
<span id="cb7-13"><a href="#cb7-13"></a>       xlabel<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb7-14"><a href="#cb7-14"></a>       ylabel<span class="op">=</span><span class="st">"annual precipitation (mm)"</span>,</span>
<span id="cb7-15"><a href="#cb7-15"></a>       xlim<span class="op">=</span>[df_year.index[<span class="dv">0</span>], df_year.index[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb7-16"><a href="#cb7-16"></a>      )</span>
<span id="cb7-17"><a href="#cb7-17"></a></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co"># write mean on the right</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>ax.text(df_year.index[<span class="op">-</span><span class="dv">1</span>], rain_mean, <span class="st">" mean</span><span class="ch">\n</span><span class="st"> </span><span class="sc">{:.0f}</span><span class="st"> mm"</span>.<span class="bu">format</span>(rain_mean),</span>
<span id="cb7-20"><a href="#cb7-20"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>, verticalalignment<span class="op">=</span><span class="st">"center"</span>)<span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21"></a></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co"># save figure</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co"># plt.savefig("annual_tel_aviv_with_mean.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-8" class="cell">
<details class="code-fold">
<summary>plot histogram</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># calculate mean and standard deviation</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>rain_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb8-5"><a href="#cb8-5"></a>rain_std <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].std()</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co"># plot histogram</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>b <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1101</span>, <span class="dv">100</span>)  <span class="co"># bins from 0 to 55, width = 5</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>ax.hist(df_year, bins<span class="op">=</span>b)</span>
<span id="cb8-10"><a href="#cb8-10"></a></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co"># plot vertical lines with mean, std, etc</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>ylim <span class="op">=</span> np.array(ax.get_ylim())</span>
<span id="cb8-13"><a href="#cb8-13"></a>ylim[<span class="dv">1</span>] <span class="op">=</span> ylim[<span class="dv">1</span>]<span class="op">*</span><span class="fl">1.1</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>ax.plot([rain_mean]<span class="op">*</span><span class="dv">2</span>, ylim, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"tab:orange"</span>)</span>
<span id="cb8-15"><a href="#cb8-15"></a>ax.plot([rain_mean<span class="op">+</span>rain_std]<span class="op">*</span><span class="dv">2</span>, ylim, linewidth<span class="op">=</span><span class="dv">3</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-16"><a href="#cb8-16"></a>ax.plot([rain_mean<span class="op">-</span>rain_std]<span class="op">*</span><span class="dv">2</span>, ylim, linewidth<span class="op">=</span><span class="dv">3</span>, linestyle<span class="op">=</span><span class="st">"--"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-17"><a href="#cb8-17"></a>ax.set_ylim(ylim)</span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co"># write mean, std, etc</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>ax.text(rain_mean, ylim[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.99</span>, <span class="st">"mean"</span>,</span>
<span id="cb8-21"><a href="#cb8-21"></a>        horizontalalignment<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb8-22"><a href="#cb8-22"></a>        verticalalignment<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb8-23"><a href="#cb8-23"></a>        )</span>
<span id="cb8-24"><a href="#cb8-24"></a>ax.text(rain_mean<span class="op">+</span>rain_std, ylim[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.99</span>, <span class="st">"mean+std"</span>,</span>
<span id="cb8-25"><a href="#cb8-25"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb8-26"><a href="#cb8-26"></a>        verticalalignment<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb8-27"><a href="#cb8-27"></a>        )</span>
<span id="cb8-28"><a href="#cb8-28"></a>ax.text(rain_mean<span class="op">-</span>rain_std, ylim[<span class="dv">1</span>]<span class="op">*</span><span class="fl">0.99</span>, <span class="st">"mean-std"</span>,</span>
<span id="cb8-29"><a href="#cb8-29"></a>        horizontalalignment<span class="op">=</span><span class="st">"right"</span>,</span>
<span id="cb8-30"><a href="#cb8-30"></a>        verticalalignment<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb8-31"><a href="#cb8-31"></a>        )</span>
<span id="cb8-32"><a href="#cb8-32"></a></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="co"># adjust labels, ticks, title, limits, etc</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Histogram of annual precipitation in Tel Aviv, 1940–1999"</span>,</span>
<span id="cb8-35"><a href="#cb8-35"></a>       xlabel<span class="op">=</span><span class="st">"annual rainfall (mm)"</span>,</span>
<span id="cb8-36"><a href="#cb8-36"></a>       ylabel<span class="op">=</span><span class="st">"number of years"</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>       )<span class="op">;</span></span>
<span id="cb8-38"><a href="#cb8-38"></a></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="co"># save figure</span></span>
<span id="cb8-40"><a href="#cb8-40"></a><span class="co"># plt.savefig("histogram_tel_aviv_with_mean_and_std.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-9" class="cell">
<details class="code-fold">
<summary>load and process data for Eilat</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a>df_eilat <span class="op">=</span> pd.read_csv(<span class="st">"Eilat_monthly.csv"</span>,</span>
<span id="cb9-2"><a href="#cb9-2"></a>                       sep<span class="op">=</span><span class="st">","</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>                       parse_dates<span class="op">=</span>[<span class="st">'DATE'</span>],</span>
<span id="cb9-4"><a href="#cb9-4"></a>                       index_col<span class="op">=</span><span class="st">'DATE'</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>                      )</span>
<span id="cb9-6"><a href="#cb9-6"></a>df_year_eilat <span class="op">=</span> df_eilat[<span class="st">'PRCP'</span>].resample(<span class="st">'YE-SEP'</span>).<span class="bu">sum</span>().to_frame()  <span class="co"># yearly frequency, anchored end of September</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>df_year_eilat.columns <span class="op">=</span> [<span class="st">'rain (mm)'</span>] <span class="co"># rename 'PRCP' column to 'rain (mm)'</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>df_year_eilat <span class="op">=</span> df_year_eilat.iloc[<span class="dv">2</span>:<span class="op">-</span><span class="dv">5</span>]  <span class="co"># exclude first two and last two years</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-10" class="cell">
<details class="code-fold">
<summary>plot Tel Aviv vs.&nbsp;Eilat</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>ax.plot(df_year[<span class="st">'rain (mm)'</span>], label<span class="op">=</span><span class="st">"Tel Aviv"</span>, color<span class="op">=</span><span class="st">"xkcd:hot pink"</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>ax.plot(df_year_eilat[<span class="st">'rain (mm)'</span>], label<span class="op">=</span><span class="st">"Eilat"</span>, color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>ax.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">"annual precipitation (mm)"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>       title<span class="op">=</span><span class="st">"which location has largest variations in precipitation?"</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>       ylim<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1100</span>])</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a>mean_telaviv <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb10-12"><a href="#cb10-12"></a>mean_eilat <span class="op">=</span> df_year_eilat[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb10-13"><a href="#cb10-13"></a>std_telaviv <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].std()</span>
<span id="cb10-14"><a href="#cb10-14"></a>std_eilat <span class="op">=</span> df_year_eilat[<span class="st">'rain (mm)'</span>].std()</span>
<span id="cb10-15"><a href="#cb10-15"></a>cv_telaviv <span class="op">=</span> std_telaviv <span class="op">/</span> mean_telaviv</span>
<span id="cb10-16"><a href="#cb10-16"></a>cv_eilat <span class="op">=</span> std_eilat <span class="op">/</span> mean_eilat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-11" class="cell">
<details class="code-fold">
<summary>plot Tel Aviv vs.&nbsp;Eilat</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span> ,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>ax[<span class="dv">0</span>].plot(df_year[<span class="st">'rain (mm)'</span>], label<span class="op">=</span><span class="st">"Tel Aviv"</span>, color<span class="op">=</span><span class="st">"xkcd:hot pink"</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a>ax[<span class="dv">0</span>].<span class="bu">set</span>(ylim<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span><span class="op">*</span>mean_telaviv],</span>
<span id="cb11-5"><a href="#cb11-5"></a>          yticks<span class="op">=</span>[<span class="dv">0</span>,mean_telaviv,<span class="dv">2</span><span class="op">*</span>mean_telaviv],</span>
<span id="cb11-6"><a href="#cb11-6"></a>          yticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'mean(Tel Aviv)'</span>, <span class="vs">r'$2\times$ mean(Tel Aviv)'</span>],</span>
<span id="cb11-7"><a href="#cb11-7"></a>          title<span class="op">=</span><span class="st">"Tel Aviv"</span>)</span>
<span id="cb11-8"><a href="#cb11-8"></a>concise(ax[<span class="dv">0</span>])</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>ax[<span class="dv">1</span>].plot(df_year_eilat[<span class="st">'rain (mm)'</span>], label<span class="op">=</span><span class="st">"Eilat"</span>, color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb11-11"><a href="#cb11-11"></a>ax[<span class="dv">1</span>].<span class="bu">set</span>(ylim<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">2</span><span class="op">*</span>mean_eilat],</span>
<span id="cb11-12"><a href="#cb11-12"></a>          yticks<span class="op">=</span>[<span class="dv">0</span>,mean_eilat,<span class="dv">2</span><span class="op">*</span>mean_eilat],</span>
<span id="cb11-13"><a href="#cb11-13"></a>          yticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'mean(Eilat)'</span>, <span class="vs">r'$2\times$ mean(Eilat)'</span>],</span>
<span id="cb11-14"><a href="#cb11-14"></a>          title<span class="op">=</span><span class="st">"Eilat"</span>)</span>
<span id="cb11-15"><a href="#cb11-15"></a>ax[<span class="dv">1</span>].yaxis.set_label_position(<span class="st">"right"</span>)</span>
<span id="cb11-16"><a href="#cb11-16"></a>ax[<span class="dv">1</span>].yaxis.tick_right()</span>
<span id="cb11-17"><a href="#cb11-17"></a>concise(ax[<span class="dv">1</span>])</span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a>fig.suptitle(<span class="st">'which location has largest variations in precipitation?'</span>, y<span class="op">=</span><span class="fl">1.0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>Text(0.5, 1.0, 'which location has largest variations in precipitation?')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="coefficient-of-variation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="coefficient-of-variation"><span class="header-section-number">5.1</span> coefficient of variation</h2>
<p><span class="math inline">\langle{P}\rangle=</span> average precipitation<br>
<span class="math inline">\sigma=</span> standard deviation</p>
<p><span class="math display">CV = \frac{\sigma}{\langle{P}\rangle}</span></p>
<p>The coefficient of variation (dimensionless) quantifies the variation (std) magnitude with respect to the mean. In the examples above, although Tel Aviv has a much higher standard deviation in annual precipitation, the spread of precipitation in Eilat is <strong>much larger</strong>, considered relative to its average.</p>
<div id="cell-13" class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="bu">print</span>(<span class="ss">f"Tel Aviv:</span><span class="ch">\t</span><span class="ss">std = </span><span class="sc">{</span>std_telaviv<span class="sc">:.2f}</span><span class="ss"> mm</span><span class="ch">\t\t</span><span class="ss">CV = </span><span class="sc">{</span>cv_telaviv<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="bu">print</span>(<span class="ss">f"Eilat:</span><span class="ch">\t\t</span><span class="ss">std = </span><span class="sc">{</span>std_eilat<span class="sc">:.2f}</span><span class="ss"> mm</span><span class="ch">\t\t</span><span class="ss">CV = </span><span class="sc">{</span>cv_eilat<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Tel Aviv:   std = 161.19 mm     CV = 0.30
Eilat:      std = 20.49 mm      CV = 0.77</code></pre>
</div>
</div>
<p>Another way to understand the CV: for gaussian (normal) distributions, 67% of the data lies 1 std from the mean. <strong>Assuming</strong> that the annual rainfall for Tel Aviv and Eilat roughly follows a gaussian distribution, we could say that:</p>
<ul>
<li>Tel Aviv: about 67% of the annual precipitation is no more than 30% from the average.</li>
<li>Eilat: about 67% of the annual precipitation is no more than 77% from the average.</li>
</ul>
</section>
<section id="climate-normals" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="climate-normals"><span class="header-section-number">5.2</span> climate normals</h2>
<p>Precipitation averages are usually calculated for time intervals of 30 years. According to the <a href="https://www.weather.gov/iln/NewNormals">National Oceanic and Atmospheric Administration — NOAA</a>:</p>
<blockquote class="blockquote">
<p>Normals serve two purposes: a reference period for monitoring current weather and climate, and a good description of the expected climate at a location over the seasons. They provide a basis for determining whether today’s weather is warmer or colder, wetter or drier. They also can be used to plan for conditions beyond the time span of reliable weather forecasts. A 30-year time period was chosen by the governing body of international meteorology in the 1930s, so the first normals were for 1901-1930, the longest period for which most countries had reliable climate records. International normals were called for in 1931-1960 and 1961-1990, but many countries updated normals more frequently, every 10 years, so as to keep them up to date. In 2015 this was made the WMO standard, so all countries will be creating normals for 1991-2020.</p>
</blockquote>
</section>
<section id="running-averages" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="running-averages"><span class="header-section-number">5.3</span> running averages</h2>
<div id="cell-17" class="cell">
<details class="code-fold">
<summary>plot 30-year averages</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>ax.plot(df_year[<span class="st">'rain (mm)'</span>], color<span class="op">=</span><span class="st">"lightgray"</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co"># windows of length 30 years</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>windows <span class="op">=</span> [[<span class="dv">1940</span>,<span class="dv">1969</span>], [<span class="dv">1970</span>,<span class="dv">1999</span>]]</span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="cf">for</span> window <span class="kw">in</span> windows:</span>
<span id="cb15-8"><a href="#cb15-8"></a>    start_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">:d}</span><span class="ss">-09-30"</span></span>
<span id="cb15-9"><a href="#cb15-9"></a>    end_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">:d}</span><span class="ss">-09-30"</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>    window_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>][start_date:end_date].mean()</span>
<span id="cb15-11"><a href="#cb15-11"></a>    ax.plot(df_year[start_date:end_date]<span class="op">*</span><span class="dv">0</span><span class="op">+</span>window_mean, color<span class="op">=</span><span class="st">"purple"</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb15-12"><a href="#cb15-12"></a>    ax.text(start_date, window_mean<span class="op">+</span><span class="dv">5</span>, <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">:  </span><span class="sc">{</span>window_mean<span class="sc">:.0f}</span><span class="ss"> mm"</span>,)</span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co"># plot mean</span></span>
<span id="cb15-15"><a href="#cb15-15"></a>rain_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb15-16"><a href="#cb15-16"></a>ax.plot(df_year<span class="op">*</span><span class="dv">0</span> <span class="op">+</span> rain_mean, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a>ax.text(df_year.index[<span class="op">-</span><span class="dv">1</span>], rain_mean, <span class="st">" mean"</span>.<span class="bu">format</span>(rain_mean),</span>
<span id="cb15-18"><a href="#cb15-18"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>, verticalalignment<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb15-19"><a href="#cb15-19"></a>        color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb15-20"><a href="#cb15-20"></a></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co"># adjust labels, ticks, title, limits, etc</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Annual precipitation averages in Tel Aviv, 1940–1999"</span>,</span>
<span id="cb15-23"><a href="#cb15-23"></a>       xlabel<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb15-24"><a href="#cb15-24"></a>       ylabel<span class="op">=</span><span class="st">"annual precipitation (mm)"</span>,</span>
<span id="cb15-25"><a href="#cb15-25"></a>       xlim<span class="op">=</span>[df_year.index[<span class="dv">0</span>], df_year.index[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb15-26"><a href="#cb15-26"></a>       ylim<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1100</span>],</span>
<span id="cb15-27"><a href="#cb15-27"></a>      )<span class="op">;</span></span>
<span id="cb15-28"><a href="#cb15-28"></a></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="co"># save figure</span></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="co"># plt.savefig("mean_tel_aviv_2_windows.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-18" class="cell">
<details class="code-fold">
<summary>plot 30-year averages</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co"># windows of length 30 years</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>windows <span class="op">=</span> [[x,x<span class="op">+</span><span class="dv">29</span>] <span class="cf">for</span> x <span class="kw">in</span> [<span class="dv">1940</span>,<span class="dv">1950</span>,<span class="dv">1960</span>,<span class="dv">1970</span>]]</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="cf">for</span> window <span class="kw">in</span> windows:</span>
<span id="cb16-6"><a href="#cb16-6"></a>    start_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">:d}</span><span class="ss">-09-30"</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    end_date <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">:d}</span><span class="ss">-09-30"</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>    window_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>][start_date:end_date].mean()</span>
<span id="cb16-9"><a href="#cb16-9"></a>    ax.plot(df_year[start_date:end_date]<span class="op">*</span><span class="dv">0</span><span class="op">+</span>window_mean, color<span class="op">=</span><span class="st">"purple"</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>    ax.text(start_date, window_mean<span class="op">+</span><span class="fl">0.5</span>, <span class="ss">f"</span><span class="sc">{</span>window[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>window[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">:  </span><span class="sc">{</span>window_mean<span class="sc">:.0f}</span><span class="ss"> mm"</span>,)</span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co"># plot mean</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>rain_mean <span class="op">=</span> df_year[<span class="st">'rain (mm)'</span>].mean()</span>
<span id="cb16-14"><a href="#cb16-14"></a>ax.plot(df_year<span class="op">*</span><span class="dv">0</span> <span class="op">+</span> rain_mean, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-15"><a href="#cb16-15"></a>ax.text(df_year.index[<span class="op">-</span><span class="dv">1</span>], rain_mean, <span class="st">" mean"</span>.<span class="bu">format</span>(rain_mean),</span>
<span id="cb16-16"><a href="#cb16-16"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>, verticalalignment<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb16-17"><a href="#cb16-17"></a>        color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb16-18"><a href="#cb16-18"></a></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co"># adjust labels, ticks, title, limits, etc</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Annual precipitation averages in Tel Aviv, 1940–1999"</span>,</span>
<span id="cb16-21"><a href="#cb16-21"></a>       xlabel<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb16-22"><a href="#cb16-22"></a>       ylabel<span class="op">=</span><span class="st">"annual precipitation (mm)"</span>,</span>
<span id="cb16-23"><a href="#cb16-23"></a>       xlim<span class="op">=</span>[df_year.index[<span class="dv">0</span>], df_year.index[<span class="op">-</span><span class="dv">1</span>]],</span>
<span id="cb16-24"><a href="#cb16-24"></a>       ylim<span class="op">=</span>[<span class="dv">500</span>, <span class="dv">560</span>],</span>
<span id="cb16-25"><a href="#cb16-25"></a>      )<span class="op">;</span></span>
<span id="cb16-26"><a href="#cb16-26"></a></span>
<span id="cb16-27"><a href="#cb16-27"></a><span class="co"># save figure</span></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="co"># plt.savefig("mean_tel_aviv_2_windows.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-19" class="cell">
<details class="code-fold">
<summary>widget for rolling average</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co"># Custom theme for readability</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="kw">def</span> readable():   </span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="cf">return</span> {</span>
<span id="cb17-6"><a href="#cb17-6"></a>        <span class="st">"config"</span> : {</span>
<span id="cb17-7"><a href="#cb17-7"></a>             <span class="st">"title"</span>: {<span class="st">'fontSize'</span>: <span class="dv">16</span>},</span>
<span id="cb17-8"><a href="#cb17-8"></a>             <span class="st">"axis"</span>: {</span>
<span id="cb17-9"><a href="#cb17-9"></a>                  <span class="st">"labelFontSize"</span>: <span class="dv">16</span>,</span>
<span id="cb17-10"><a href="#cb17-10"></a>                  <span class="st">"titleFontSize"</span>: <span class="dv">16</span>,</span>
<span id="cb17-11"><a href="#cb17-11"></a>             },</span>
<span id="cb17-12"><a href="#cb17-12"></a>             <span class="st">"header"</span>: {</span>
<span id="cb17-13"><a href="#cb17-13"></a>                  <span class="st">"labelFontSize"</span>: <span class="dv">14</span>,</span>
<span id="cb17-14"><a href="#cb17-14"></a>                  <span class="st">"titleFontSize"</span>: <span class="dv">14</span>,</span>
<span id="cb17-15"><a href="#cb17-15"></a>             },</span>
<span id="cb17-16"><a href="#cb17-16"></a>             <span class="st">"legend"</span>: {</span>
<span id="cb17-17"><a href="#cb17-17"></a>                  <span class="st">"labelFontSize"</span>: <span class="dv">14</span>,</span>
<span id="cb17-18"><a href="#cb17-18"></a>                  <span class="st">"titleFontSize"</span>: <span class="dv">14</span>,</span>
<span id="cb17-19"><a href="#cb17-19"></a>             },</span>
<span id="cb17-20"><a href="#cb17-20"></a>             <span class="st">"mark"</span>: {</span>
<span id="cb17-21"><a href="#cb17-21"></a>                 <span class="st">'fontSize'</span>: <span class="dv">14</span>,</span>
<span id="cb17-22"><a href="#cb17-22"></a>                 <span class="st">"tooltip"</span>: {<span class="st">"content"</span>: <span class="st">"encoding"</span>},  <span class="co"># enable tooltips</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>            },</span>
<span id="cb17-24"><a href="#cb17-24"></a>        }</span>
<span id="cb17-25"><a href="#cb17-25"></a>    }</span>
<span id="cb17-26"><a href="#cb17-26"></a></span>
<span id="cb17-27"><a href="#cb17-27"></a>alt.themes.register(<span class="st">'readable'</span>, readable)</span>
<span id="cb17-28"><a href="#cb17-28"></a>alt.themes.enable(<span class="st">'readable'</span>)</span>
<span id="cb17-29"><a href="#cb17-29"></a></span>
<span id="cb17-30"><a href="#cb17-30"></a><span class="co"># Altair only recognizes column data; it ignores index values. You can plot the index data by first resetting the index</span></span>
<span id="cb17-31"><a href="#cb17-31"></a>source <span class="op">=</span> df_year.reset_index()</span>
<span id="cb17-32"><a href="#cb17-32"></a>brush <span class="op">=</span> alt.selection_interval(encodings<span class="op">=</span>[<span class="st">'x'</span>])</span>
<span id="cb17-33"><a href="#cb17-33"></a></span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="co"># T: temporal, a time or date value</span></span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="co"># Q: quantitative, a continuous real-valued quantity</span></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="co"># https://altair-viz.github.io/user_guide/encoding.html#encoding-data-types</span></span>
<span id="cb17-37"><a href="#cb17-37"></a>bars <span class="op">=</span> alt.Chart().mark_bar().encode(</span>
<span id="cb17-38"><a href="#cb17-38"></a>    x<span class="op">=</span>alt.X(<span class="st">'DATE:T'</span>, axis<span class="op">=</span>alt.Axis(title<span class="op">=</span><span class="st">'date'</span>)),</span>
<span id="cb17-39"><a href="#cb17-39"></a>    y<span class="op">=</span>alt.Y(<span class="st">'rain (mm):Q'</span>,  axis<span class="op">=</span>alt.Axis(title<span class="op">=</span><span class="st">'annual precipitation (mm) and average'</span>)),</span>
<span id="cb17-40"><a href="#cb17-40"></a>    opacity<span class="op">=</span>alt.condition(brush, alt.OpacityValue(<span class="dv">1</span>), alt.OpacityValue(<span class="fl">0.2</span>)),</span>
<span id="cb17-41"><a href="#cb17-41"></a>).add_params(</span>
<span id="cb17-42"><a href="#cb17-42"></a>    brush</span>
<span id="cb17-43"><a href="#cb17-43"></a>).properties(</span>
<span id="cb17-44"><a href="#cb17-44"></a>    title<span class="op">=</span><span class="st">'Select year range and drag for rolling average of annual precipitation in Tel Aviv'</span></span>
<span id="cb17-45"><a href="#cb17-45"></a>).properties(</span>
<span id="cb17-46"><a href="#cb17-46"></a>    width<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb17-47"><a href="#cb17-47"></a>    height<span class="op">=</span><span class="dv">400</span></span>
<span id="cb17-48"><a href="#cb17-48"></a>)</span>
<span id="cb17-49"><a href="#cb17-49"></a></span>
<span id="cb17-50"><a href="#cb17-50"></a>line <span class="op">=</span> alt.Chart().mark_rule(color<span class="op">=</span><span class="st">'orange'</span>).encode(</span>
<span id="cb17-51"><a href="#cb17-51"></a>    y<span class="op">=</span><span class="st">'mean(rain (mm)):Q'</span>,</span>
<span id="cb17-52"><a href="#cb17-52"></a>    size<span class="op">=</span>alt.SizeValue(<span class="dv">3</span>)</span>
<span id="cb17-53"><a href="#cb17-53"></a>).transform_filter(</span>
<span id="cb17-54"><a href="#cb17-54"></a>    brush</span>
<span id="cb17-55"><a href="#cb17-55"></a>)</span>
<span id="cb17-56"><a href="#cb17-56"></a></span>
<span id="cb17-57"><a href="#cb17-57"></a>alt.layer(bars, line, data<span class="op">=</span>source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="70">

<style>
  #altair-viz-917d1d1418da463dabb81ba36ed6de9f.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-917d1d1418da463dabb81ba36ed6de9f.vega-embed details,
  #altair-viz-917d1d1418da463dabb81ba36ed6de9f.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-917d1d1418da463dabb81ba36ed6de9f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-917d1d1418da463dabb81ba36ed6de9f") {
      outputDiv = document.getElementById("altair-viz-917d1d1418da463dabb81ba36ed6de9f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"title": {"fontSize": 16}, "axis": {"labelFontSize": 16, "titleFontSize": 16}, "header": {"labelFontSize": 14, "titleFontSize": 14}, "legend": {"labelFontSize": 14, "titleFontSize": 14}, "mark": {"fontSize": 14, "tooltip": {"content": "encoding"}}}, "layer": [{"mark": {"type": "bar"}, "encoding": {"opacity": {"condition": {"param": "param_2", "value": 1}, "value": 0.2}, "x": {"axis": {"title": "date"}, "field": "DATE", "type": "temporal"}, "y": {"axis": {"title": "annual precipitation (mm) and average"}, "field": "rain (mm)", "type": "quantitative"}}, "name": "view_2", "title": "Select year range and drag for rolling average of annual precipitation in Tel Aviv"}, {"mark": {"type": "rule", "color": "orange"}, "encoding": {"size": {"value": 3}, "y": {"aggregate": "mean", "field": "rain (mm)", "type": "quantitative"}}, "transform": [{"filter": {"param": "param_2"}}]}], "data": {"name": "data-d3d62ccd89e6626bcb1b568452363acd"}, "height": 400, "params": [{"name": "param_2", "select": {"type": "interval", "encodings": ["x"]}, "views": ["view_2"]}], "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v5.17.0.json", "datasets": {"data-d3d62ccd89e6626bcb1b568452363acd": [{"DATE": "1940-09-30T00:00:00", "rain (mm)": 474.9}, {"DATE": "1941-09-30T00:00:00", "rain (mm)": 447.8}, {"DATE": "1942-09-30T00:00:00", "rain (mm)": 372.9}, {"DATE": "1943-09-30T00:00:00", "rain (mm)": 618.2}, {"DATE": "1944-09-30T00:00:00", "rain (mm)": 440.5}, {"DATE": "1945-09-30T00:00:00", "rain (mm)": 810.6}, {"DATE": "1946-09-30T00:00:00", "rain (mm)": 577.3}, {"DATE": "1947-09-30T00:00:00", "rain (mm)": 327.79999999999995}, {"DATE": "1948-09-30T00:00:00", "rain (mm)": 484.5}, {"DATE": "1949-09-30T00:00:00", "rain (mm)": 566.1}, {"DATE": "1950-09-30T00:00:00", "rain (mm)": 844.1}, {"DATE": "1951-09-30T00:00:00", "rain (mm)": 343.8}, {"DATE": "1952-09-30T00:00:00", "rain (mm)": 668.9}, {"DATE": "1953-09-30T00:00:00", "rain (mm)": 564.5}, {"DATE": "1954-09-30T00:00:00", "rain (mm)": 636.8}, {"DATE": "1955-09-30T00:00:00", "rain (mm)": 524.4000000000001}, {"DATE": "1956-09-30T00:00:00", "rain (mm)": 814.8}, {"DATE": "1957-09-30T00:00:00", "rain (mm)": 568.4}, {"DATE": "1958-09-30T00:00:00", "rain (mm)": 459.8}, {"DATE": "1959-09-30T00:00:00", "rain (mm)": 378.40000000000003}, {"DATE": "1960-09-30T00:00:00", "rain (mm)": 301.7}, {"DATE": "1961-09-30T00:00:00", "rain (mm)": 578.9}, {"DATE": "1962-09-30T00:00:00", "rain (mm)": 658.6999999999999}, {"DATE": "1963-09-30T00:00:00", "rain (mm)": 392.1}, {"DATE": "1964-09-30T00:00:00", "rain (mm)": 622.7}, {"DATE": "1965-09-30T00:00:00", "rain (mm)": 755.5}, {"DATE": "1966-09-30T00:00:00", "rain (mm)": 331.0}, {"DATE": "1967-09-30T00:00:00", "rain (mm)": 663.6}, {"DATE": "1968-09-30T00:00:00", "rain (mm)": 412.4}, {"DATE": "1969-09-30T00:00:00", "rain (mm)": 669.4}, {"DATE": "1970-09-30T00:00:00", "rain (mm)": 415.1}, {"DATE": "1971-09-30T00:00:00", "rain (mm)": 382.0}, {"DATE": "1972-09-30T00:00:00", "rain (mm)": 620.4}, {"DATE": "1973-09-30T00:00:00", "rain (mm)": 440.5}, {"DATE": "1974-09-30T00:00:00", "rain (mm)": 697.5}, {"DATE": "1975-09-30T00:00:00", "rain (mm)": 581.7}, {"DATE": "1976-09-30T00:00:00", "rain (mm)": 389.8}, {"DATE": "1977-09-30T00:00:00", "rain (mm)": 606.8}, {"DATE": "1978-09-30T00:00:00", "rain (mm)": 484.3}, {"DATE": "1979-09-30T00:00:00", "rain (mm)": 324.7}, {"DATE": "1980-09-30T00:00:00", "rain (mm)": 617.6}, {"DATE": "1981-09-30T00:00:00", "rain (mm)": 490.40000000000003}, {"DATE": "1982-09-30T00:00:00", "rain (mm)": 446.0}, {"DATE": "1983-09-30T00:00:00", "rain (mm)": 602.4}, {"DATE": "1984-09-30T00:00:00", "rain (mm)": 270.3}, {"DATE": "1985-09-30T00:00:00", "rain (mm)": 343.2}, {"DATE": "1986-09-30T00:00:00", "rain (mm)": 360.2}, {"DATE": "1987-09-30T00:00:00", "rain (mm)": 573.6}, {"DATE": "1988-09-30T00:00:00", "rain (mm)": 659.6}, {"DATE": "1989-09-30T00:00:00", "rain (mm)": 488.9}, {"DATE": "1990-09-30T00:00:00", "rain (mm)": 648.5}, {"DATE": "1991-09-30T00:00:00", "rain (mm)": 468.90000000000003}, {"DATE": "1992-09-30T00:00:00", "rain (mm)": 1064.3999999999999}, {"DATE": "1993-09-30T00:00:00", "rain (mm)": 577.9}, {"DATE": "1994-09-30T00:00:00", "rain (mm)": 350.9}, {"DATE": "1995-09-30T00:00:00", "rain (mm)": 804.6999999999999}, {"DATE": "1996-09-30T00:00:00", "rain (mm)": 488.20000000000005}, {"DATE": "1997-09-30T00:00:00", "rain (mm)": 619.1}, {"DATE": "1998-09-30T00:00:00", "rain (mm)": 489.6}, {"DATE": "1999-09-30T00:00:00", "rain (mm)": 226.5}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
<div id="cell-20" class="cell">
<details class="code-fold">
<summary>plot rolling average</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">7</span>))</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>ax.plot(df_year[<span class="st">'rain (mm)'</span>], color<span class="op">=</span><span class="st">"lightgray"</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co"># plot rolling mean</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>rolling_mean <span class="op">=</span> df_year.rolling(window<span class="op">=</span><span class="dv">30</span>, center<span class="op">=</span><span class="va">True</span>).mean()</span>
<span id="cb18-7"><a href="#cb18-7"></a>ax.plot(rolling_mean, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"purple"</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb18-8"><a href="#cb18-8"></a>ax.text(pd.to_datetime(<span class="st">"1970"</span>), <span class="dv">450</span>, <span class="st">"rolling mean"</span>.<span class="bu">format</span>(rain_mean),</span>
<span id="cb18-9"><a href="#cb18-9"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>, verticalalignment<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>        color<span class="op">=</span><span class="st">"purple"</span>,)</span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co"># plot mean</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>ax.plot(df_year<span class="op">*</span><span class="dv">0</span> <span class="op">+</span> rain_mean, linewidth<span class="op">=</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb18-14"><a href="#cb18-14"></a>ax.text(df_year.index[<span class="op">-</span><span class="dv">1</span>], rain_mean, <span class="st">" mean"</span>.<span class="bu">format</span>(rain_mean),</span>
<span id="cb18-15"><a href="#cb18-15"></a>        horizontalalignment<span class="op">=</span><span class="st">"left"</span>, verticalalignment<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb18-16"><a href="#cb18-16"></a>        color<span class="op">=</span><span class="st">"tab:orange"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb18-17"><a href="#cb18-17"></a></span>
<span id="cb18-18"><a href="#cb18-18"></a>ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"30-year rolling average, Tel Aviv"</span>,</span>
<span id="cb18-19"><a href="#cb18-19"></a>       xlabel<span class="op">=</span><span class="st">"date"</span>,</span>
<span id="cb18-20"><a href="#cb18-20"></a>       ylabel<span class="op">=</span><span class="st">"annual precipitation (mm)"</span>,</span>
<span id="cb18-21"><a href="#cb18-21"></a>       ylim<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1100</span>],</span>
<span id="cb18-22"><a href="#cb18-22"></a>       xlim<span class="op">=</span>[df_year.index[<span class="dv">0</span>], df_year.index[<span class="op">-</span><span class="dv">1</span>]]</span>
<span id="cb18-23"><a href="#cb18-23"></a>      )<span class="op">;</span></span>
<span id="cb18-24"><a href="#cb18-24"></a><span class="co"># save figure</span></span>
<span id="cb18-25"><a href="#cb18-25"></a><span class="co"># plt.savefig("rolling_average_tel_aviv.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="interannual-lecture_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../precipitation/intra-annual-exercises.html" class="pagination-link" aria-label="Exercises">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exercises</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../precipitation/interannual-exercises.html" class="pagination-link" aria-label="Exercises">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exercises</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>