<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Surface Hydrology - 16&nbsp; Budyko framework</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../summing-up/spatial-distribution.html" rel="next">
<link href="../streamflow/unit-hydrograph-lecture.html" rel="prev">
<link href="../archive/cloud-rain.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../summing-up/budyko-framework-lecture.html">summing up</a></li><li class="breadcrumb-item"><a href="../summing-up/budyko-framework-lecture.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Budyko framework</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../archive/cloud-rain.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Surface Hydrology</a> 
        <div class="sidebar-tools-main">
    <a href="https://yairmau.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house"></i></a>
    <a href="https://github.com/yairmau/surface-hydrology/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/introduction-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Water Cycle: Fluxes and Storage</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/introduction-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../precipitation/precipitation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Precipitation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/intra-annual-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Intra-annual variability of precipitation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/intra-annual-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/interannual-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Interannual variability of precipitation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/interannual-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/return-period-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Return Period</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../precipitation/return-period-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Evapotranspiration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evapotranspiration/evapotranspiration-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Evapotranspiration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../evapotranspiration/evapotranspiration-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../infiltration/infiltration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infiltration</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infiltration/infiltration-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Infiltration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../infiltration/infiltration-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Streamflow</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/streamflow-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Streamflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/streamflow-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../streamflow/unit-hydrograph-lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Unit Hydrograph</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">summing up</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summing-up/budyko-framework-lecture.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Budyko framework</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summing-up/spatial-distribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial distribution - lecture</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../assignments/assignments-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment0-first-graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Assignment - first graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment1-return-period.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Assignment - return period</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment2-ET-NOAA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Assignment - ET</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../appendix/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/date_formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Gain full control of date formatting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/plotting-guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Plotting guidelines</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#water-and-surface-energy-balances" id="toc-water-and-surface-energy-balances" class="nav-link active" data-scroll-target="#water-and-surface-energy-balances"><span class="header-section-number">16.1</span> Water and surface energy balances</a></li>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions"><span class="header-section-number">16.2</span> Assumptions</a></li>
  <li><a href="#question" id="toc-question" class="nav-link" data-scroll-target="#question"><span class="header-section-number">16.3</span> Question</a></li>
  <li><a href="#limits" id="toc-limits" class="nav-link" data-scroll-target="#limits"><span class="header-section-number">16.4</span> Limits</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">16.4.1</span> Summary:</a></li>
  </ul></li>
  <li><a href="#hypotheses-for-why-dryness-index-controls-so-much-the-partitioning-of-p-into-et-and-q" id="toc-hypotheses-for-why-dryness-index-controls-so-much-the-partitioning-of-p-into-et-and-q" class="nav-link" data-scroll-target="#hypotheses-for-why-dryness-index-controls-so-much-the-partitioning-of-p-into-et-and-q"><span class="header-section-number">16.5</span> Hypotheses for why dryness index controls so much the partitioning of P into ET and Q</a></li>
  <li><a href="#hypotheses-for-deviations-from-budyko-curve" id="toc-hypotheses-for-deviations-from-budyko-curve" class="nav-link" data-scroll-target="#hypotheses-for-deviations-from-budyko-curve"><span class="header-section-number">16.6</span> Hypotheses for deviations from Budyko curve</a>
  <ul class="collapse">
  <li><a href="#reasons-for-falling-off-the-budyko-curve" id="toc-reasons-for-falling-off-the-budyko-curve" class="nav-link" data-scroll-target="#reasons-for-falling-off-the-budyko-curve"><span class="header-section-number">16.6.1</span> Reasons for falling off the Budyko Curve</a></li>
  <li><a href="#critique" id="toc-critique" class="nav-link" data-scroll-target="#critique"><span class="header-section-number">16.6.2</span> Critique</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../summing-up/budyko-framework-lecture.html">summing up</a></li><li class="breadcrumb-item"><a href="../summing-up/budyko-framework-lecture.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Budyko framework</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Budyko framework</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/yairmau/surface-hydrology/blob/main/summing-up/budyko-framework-lecture.qmd"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Sources used</strong>:</p>
<p><span class="citation" data-cites="daly2019linking">Daly et al. (<a href="../references.html#ref-daly2019linking" role="doc-biblioref">2019</a>)</span>, <span class="citation" data-cites="sposito2017understanding">Sposito (<a href="../references.html#ref-sposito2017understanding" role="doc-biblioref">2017</a>)</span>, <span class="citation" data-cites="jones2012ecosystem">Jones et al. (<a href="../references.html#ref-jones2012ecosystem" role="doc-biblioref">2012</a>)</span>, <span class="citation" data-cites="krajewski2021attempt">Krajewski et al. (<a href="../references.html#ref-krajewski2021attempt" role="doc-biblioref">2021</a>)</span>, <span class="citation" data-cites="berghuijs2020unanswered">Berghuijs, Gnann, and Woods (<a href="../references.html#ref-berghuijs2020unanswered" role="doc-biblioref">2020</a>)</span>, <span class="citation" data-cites="creed2012budyko">Creed and Spargo (<a href="../references.html#ref-creed2012budyko" role="doc-biblioref">2012</a>)</span></p>
<section id="water-and-surface-energy-balances" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="water-and-surface-energy-balances"><span class="header-section-number">16.1</span> Water and surface energy balances</h2>
<p>For long-term averages:</p>
<p><span class="math display">
P = ET+Q
</span></p>
<p><span class="math display">
R_n = \lambda_w\cdot ET + H
</span></p>
<ul>
<li><span class="math inline">P</span>: precipitation (L T<span class="math inline">^{-1}</span>, e.g.: mm/day)</li>
<li><span class="math inline">ET</span>: evapotranspiration (L T<span class="math inline">^{-1}</span>)</li>
<li><span class="math inline">Q</span>: streamflow (L T<span class="math inline">^{-1}</span>)</li>
<li><span class="math inline">R_n</span>: net energy available at soil surface (M T<span class="math inline">^{-3}</span>, e.g.: W m<span class="math inline">^{-2}</span>)</li>
<li><span class="math inline">\lambda_w</span>: latent heat of vaporization of water (M L<span class="math inline">^{-1}</span>T<span class="math inline">^{-2}</span>, as defined here, the units will be weird)</li>
<li><span class="math inline">H</span>: sensible heat flux from the surface into the atmosphere (M T<span class="math inline">^{-3}</span>)</li>
<li><span class="math inline">\lambda_w \cdot ET</span>: latent heat flux (M T<span class="math inline">^{-3}</span>)</li>
</ul>
</section>
<section id="assumptions" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="assumptions"><span class="header-section-number">16.2</span> Assumptions</h2>
<ol type="1">
<li>because we are dealing with long-term averages, there are negligible changes of watershed stored water.</li>
<li>negligible energy is stored at the soil surface, and heat transfer from soil surface to deeper soil layers (<span class="math inline">G</span>) averages zero.</li>
</ol>
</section>
<section id="question" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="question"><span class="header-section-number">16.3</span> Question</h2>
<p>Given measurements of rainfall and meteorological conditions, can we predict the partitioning of <span class="math inline">P</span> between <span class="math inline">ET</span> and <span class="math inline">Q</span>?</p>
</section>
<section id="limits" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="limits"><span class="header-section-number">16.4</span> Limits</h2>
<p>For very dry watersheds (deserts, for example), almost all precipitation (<span class="math inline">P</span>) is lost via evapotranspiration (<span class="math inline">ET</span>). These watersheds are called water limited.</p>
<p>In wet watersheds, at the annual scale, the sensible heat (<span class="math inline">H</span>) is directed from the surface to the atmosphere in almost all climatic zones on Earth (meaning: soil heats air). Therefore, <span class="math inline">H</span> cannot supply much energy to the soil surface, and it is assumed that <span class="math inline">R_n</span> provides entirely the energy required for evapotranspiration. Dividing the second equation by <span class="math inline">\lambda_w</span>, we get <span class="math inline">R_n/\lambda_w = ET + H/\lambda_w</span>. It is clear that the maximum possible <span class="math inline">ET</span> occurs when all incoming radiation energy <span class="math inline">R_n</span> is consumed by evapotranspiration <span class="math inline">ET</span>, and there is negligible sensible heat flux <span class="math inline">H</span>. As a result, the upper limit of <span class="math inline">\lambda_w E</span> is <span class="math inline">R_n</span>, in wet watersheds. In these watersheds, called energy limited, <span class="math inline">ET</span> tends to the potential evapotranspiration (<span class="math inline">ET_0</span>).</p>
<section id="summary" class="level3" data-number="16.4.1">
<h3 data-number="16.4.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">16.4.1</span> Summary:</h3>
<p>For energy-limited watersheds</p>
<blockquote class="blockquote">
<ol type="1">
<li>As precipitation <span class="math inline">P\rightarrow \infty</span>, evapotranspiration <span class="math inline">ET\rightarrow ET_0</span></li>
</ol>
</blockquote>
<p>For water-limited watersheds</p>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>As potential evapotranspiration <span class="math inline">ET_0\rightarrow \infty</span>, actual evaporation <span class="math inline">ET\rightarrow P</span></li>
</ol>
</blockquote>
<p>In general, we can write</p>
<p><span class="math display">
ET = f(P,ET_0)
</span></p>
<p>The variables <span class="math inline">P</span> and <span class="math inline">ET</span> have the same dimenstions (L T<span class="math inline">^{-1}</span>), and we can divide the equation above by <span class="math inline">P</span>:</p>
<p><span class="math display">
\frac{ET}{P} = f(D_I),
</span></p>
<p>where <span class="math display">
D_I = \displaystyle\frac{ET_0}{P}
</span> is called the <strong>dryness index</strong>. A useful classification is</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Dryness Index</th>
<th>Classification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">D_I &lt; 1.54</span></td>
<td>Humid</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">1.54 &lt; D_I &lt; 2</span></td>
<td>Dry Subhumid</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">2 &lt; D_I &lt; 5</span></td>
<td>Semi-arid</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">5 &lt; D_I &lt; 20</span></td>
<td>Arid</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">20 &lt; D_I</span></td>
<td>Hyper-arid</td>
</tr>
</tbody>
</table>
<!-- Classification     Aridity Index   Global land area
Hyperarid   AI < 0.05   7.5%
Arid    0.05 < AI < 0.20    12.1%
Semi-arid   0.20 < AI < 0.50    17.7%
Dry subhumid    0.50 < AI < 0.65    9.9% 
 -->
<p><strong>ATTENTION</strong>. The dryness index can also be called the “Aridity Index” (<span class="math inline">AI</span>), <strong>however</strong> sometimes the <span class="math inline">AI</span> means the inverse of <span class="math inline">D_I</span>:<br>
<span class="math display">AI = 1/D_I</span><br>
Be careful to check the definitions.</p>
<p>The summary (1) and (2) above can be now represented as:</p>
<blockquote class="blockquote">
<ol type="1">
<li>As <span class="math inline">D_I\rightarrow 0</span>, <span class="math inline">\displaystyle\frac{ET}{P}\rightarrow D_I</span></li>
</ol>
</blockquote>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>As <span class="math inline">D_I\rightarrow \infty</span>, <span class="math inline">\displaystyle\frac{ET}{P}\rightarrow 1</span></li>
</ol>
</blockquote>
<p><span class="citation" data-cites="budyko1974climate">Budyko (<a href="../references.html#ref-budyko1974climate" role="doc-biblioref">1974</a>)</span>, proposed the following equation:</p>
<p><span class="math display">
\frac{ET}{P} = \left[ D_I \tanh\left( \frac{1}{D_I} \right)\left( 1-e^{-D_I} \right) \right]^{1/2}
</span></p>
<p><img src="../archive/figures/budyko2.png" class="img-fluid"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../archive/figures/jones-creed-fig5b.png" class="img-fluid figure-img"></p>
<figcaption>Source: <span class="citation" data-cites="jones2012ecosystem">Jones et al. (<a href="../references.html#ref-jones2012ecosystem" role="doc-biblioref">2012</a>)</span></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../archive/figures/Krajewski-2021-fig1.png" class="img-fluid figure-img"></p>
<figcaption>Source: <span class="citation" data-cites="krajewski2021attempt">Krajewski et al. (<a href="../references.html#ref-krajewski2021attempt" role="doc-biblioref">2021</a>)</span></figcaption>
</figure>
</div>
<p>There are many alternatives to Budyko’s equation. Many equations have adjustable parameters, such as Fu’s equation:</p>
<p><span class="math display">
\frac{ET}{P} = 1 + D_I - (1 + D_I^w)^{1/w},
</span></p>
<p>where <span class="math inline">w&gt;1</span>. Each catchment has its own specific parameter <span class="math inline">w</span>, that may represent biophysical/landscape features. There is no concensus regarding the interpretation of <span class="math inline">w</span>, ranging from an effective empirical parameter, whose relationship to biophysical features can be discerned, to an arbitrary empirical constant with no <em>a priori</em> physical meaning. Source: {% cite reaver2020reinterpreting %}</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../archive/figures/zhang-2004-fig7.png" class="img-fluid figure-img"></p>
<figcaption>Source: <span class="citation" data-cites="zhang2004rational">Zhang et al. (<a href="../references.html#ref-zhang2004rational" role="doc-biblioref">2004</a>)</span></figcaption>
</figure>
</div>
</section>
</section>
<section id="hypotheses-for-why-dryness-index-controls-so-much-the-partitioning-of-p-into-et-and-q" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="hypotheses-for-why-dryness-index-controls-so-much-the-partitioning-of-p-into-et-and-q"><span class="header-section-number">16.5</span> Hypotheses for why dryness index controls so much the partitioning of P into ET and Q</h2>
<p>Source: <span class="citation" data-cites="berghuijs2020unanswered">Berghuijs, Gnann, and Woods (<a href="../references.html#ref-berghuijs2020unanswered" role="doc-biblioref">2020</a>)</span></p>
<ol type="1">
<li>The first is that the Budyko curve is accurate because landscape features (e.g., soils and vegetation) coevolve with the local climate in such a manner that precipitation partitioning into streamflow and evapotranspiration converges towards the Budyko curve</li>
<li>A second hypothesis is that catchments over time evolve towards the supply and demand limits (rather than towards a curve), because landscapes and their vegetation are unaware of the Budyko curve but do evolve to maximize their use of available resources (including water). However, because limiting factors such as climatic variability exist (which will reduce a catchment’s ability to use all water because it cannot fully buffer the highly variable precipitation input), catchments will tend to not reach these limits. This may lead to an (apparent) existence of the Budyko curve which falls relatively close to the demand and supply limits.</li>
<li>A third hypothesis is that the existence of a strong universal relationship between aridity and catchment water balances might be explained by an underlying organizing principle such as maximum entropy production because the Budyko curve may be consistent with how hydrologic systems optimally partition water and energy</li>
<li>A fourth hypothesis is that virtually any landscape and climate combination (also those in heavily disturbed landscapes: e.g., a city, agricultural lands, etc.) will fall near the Budyko curve because climate aridity will dominate precipitation partitioning largely independent of the climate-landscape configuration or any optimization principle.</li>
</ol>
</section>
<section id="hypotheses-for-deviations-from-budyko-curve" class="level2" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="hypotheses-for-deviations-from-budyko-curve"><span class="header-section-number">16.6</span> Hypotheses for deviations from Budyko curve</h2>
<p>Source: <span class="citation" data-cites="creed2012budyko">Creed and Spargo (<a href="../references.html#ref-creed2012budyko" role="doc-biblioref">2012</a>)</span></p>
<ol type="1">
<li>Under stationary conditions (naturally occurring oscillations), catchments will fall on the Budyko Curve</li>
<li>Under non-stationary conditions (anthropogenic climate change), catchments will deviate from the Budyko Curve in a predictable manner</li>
</ol>
<section id="reasons-for-falling-off-the-budyko-curve" class="level3" data-number="16.6.1">
<h3 data-number="16.6.1" class="anchored" data-anchor-id="reasons-for-falling-off-the-budyko-curve"><span class="header-section-number">16.6.1</span> Reasons for falling off the Budyko Curve</h3>
<ol type="1">
<li>Inadequate representation of P and T (Loch Vale)</li>
<li>Inadequate representation of ET (Andrews)</li>
<li>Inadequate representation of Q (Marcell)</li>
<li>Forest conversion (Coweeta)</li>
<li>Forest disturbance (Luquillo)</li>
</ol>
</section>
<section id="critique" class="level3" data-number="16.6.2">
<h3 data-number="16.6.2" class="anchored" data-anchor-id="critique"><span class="header-section-number">16.6.2</span> Critique</h3>
<p>Source: <span class="citation" data-cites="berghuijs2020unanswered">Berghuijs, Gnann, and Woods (<a href="../references.html#ref-berghuijs2020unanswered" role="doc-biblioref">2020</a>)</span></p>
<p>The (mathematical) specifics of such studies vary, but all approaches are founded on the assumption that catchments follow a (parametric) Budyko curve when aridity changes, and that consequently all other movements in the Budyko space are caused by other factors. The validity of this assumption remains mostly untested, which seems surprising given it underpins all of these studies’ findings.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-berghuijs2020unanswered" class="csl-entry" role="listitem">
Berghuijs, Wouter R, Sebastian J Gnann, and Ross A Woods. 2020. <span>“Unanswered Questions on the Budyko Framework.”</span> <em>Journal of Hydrology</em> 265: 164–77.
</div>
<div id="ref-budyko1974climate" class="csl-entry" role="listitem">
Budyko, Mikhail Ivanovich. 1974. <span>“Climate and Life.”</span> <em>(No Title)</em>.
</div>
<div id="ref-creed2012budyko" class="csl-entry" role="listitem">
Creed, Irena, and Adam Spargo. 2012. <span>“Budyko Guide to Exploring Sustainability of Water Yields from Catchments Under Changing Environmental Conditions.”</span> <em>London, Ontario. Http://Www. Uwo. Ca/Biology/Faculty/Creed/PDFs/Presentations/PRE116. Pdf</em>.
</div>
<div id="ref-daly2019linking" class="csl-entry" role="listitem">
Daly, Edoardo, Salvatore Calabrese, Jun Yin, and Amilcare Porporato. 2019. <span>“Linking Parametric and Water-Balance Models of the Budyko and Turc Spaces.”</span> <em>Advances in Water Resources</em> 134: 103435.
</div>
<div id="ref-jones2012ecosystem" class="csl-entry" role="listitem">
Jones, Julia A, Irena F Creed, Kendra L Hatcher, Robert J Warren, Mary Beth Adams, Melinda H Benson, Emery Boose, et al. 2012. <span>“Ecosystem Processes and Human Influences Regulate Streamflow Response to Climate Change at Long-Term Ecological Research Sites.”</span> <em>BioScience</em> 62 (4): 390–404.
</div>
<div id="ref-krajewski2021attempt" class="csl-entry" role="listitem">
Krajewski, Adam, Anna E Sikorska-Senoner, Leszek Hejduk, and Kazimierz Banasik. 2021. <span>“An Attempt to Decompose the Impact of Land Use and Climate Change on Annual Runoff in a Small Agricultural Catchment.”</span> <em>Water Resources Management</em> 35 (3): 881–96.
</div>
<div id="ref-sposito2017understanding" class="csl-entry" role="listitem">
Sposito, Garrison. 2017. <span>“Understanding the Budyko Equation.”</span> <em>Water</em> 9 (4): 236.
</div>
<div id="ref-zhang2004rational" class="csl-entry" role="listitem">
Zhang, Lu, Klaus Hickel, WR Dawes, Francis HS Chiew, AW Western, and PR Briggs. 2004. <span>“A Rational Function Approach for Estimating Mean Annual Evapotranspiration.”</span> <em>Water Resources Research</em> 40 (2).
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../streamflow/unit-hydrograph-lecture.html" class="pagination-link" aria-label="Unit Hydrograph">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Unit Hydrograph</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../summing-up/spatial-distribution.html" class="pagination-link" aria-label="Spatial distribution - lecture">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial distribution - lecture</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>